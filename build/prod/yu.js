!function(){"use strict";const e=e=>t=>typeof t===e,t=e("string"),r=e("object"),n=e=>{var t;return null!==(t=null==e?void 0:e.tagName)&&void 0!==t&&t},o=e=>r(e)&&n(e),a=e=>r(e)&&!n(e),s=e=>!["innerHTML","className","classList","textContent","dataset","checked"].includes(e),c=e=>{const t={};for(const r of Object.keys(e).filter(s))t[r]=e[r].toString();return e.checked&&(t.checked=!0),t},i=(e,...r)=>{const n=document.createElement(e),{html:s,classList:i,children:l,dataset:d,attrs:h}=(e=>{var r,n,s,i,l;const d=e.flat(1/0),h=d.filter(o),u=d.filter(a).reduce(((e,t)=>Object.assign(e,t)),{}),p=d.filter(t).join(" ")||(null!==(n=null!==(r=u.innerHTML)&&void 0!==r?r:u.textContent)&&void 0!==n?n:""),m=null!==(s=u.dataset)&&void 0!==s?s:{},g=(v=null!==(i=u.class)&&void 0!==i?i:"",f=null!==(l=u.classList)&&void 0!==l?l:[],(v?v.split(" "):null!=f?f:[]).map((e=>e.trim())).filter((e=>e.length>0)));var v,f;return{attrs:c(u),html:p,classList:g,dataset:m,children:h}})(r);return n.innerHTML=s,i.forEach((e=>n.classList.add(e))),l.forEach((e=>n.appendChild(e))),Object.entries(d).forEach((([e,t])=>n.dataset[e]=t)),Object.entries(h).forEach((([e,t])=>n.setAttribute(e,t))),n},l=e=>{const t=(e=>document.evaluate(e,document,null,0))(e);return t.iterateNext()},d=e=>({on:(t,r)=>{e.addEventListener(t,r)}}),h=(e,t=document)=>t.querySelector(e),u=e=>h(`meta[property="${e}"]`),p=e=>Array.from(e.options).map((e=>{var t;return null!==(t=e.value)&&void 0!==t?t:""})),m=(e,...t)=>{const r=i(e);for(const e of t.flat(1/0))r.appendChild(e);return r},g=(()=>{try{const e=(()=>{const e=u("og:url");if(!e)throw new Error("error getting canonical URL");return new URL(e.content)})();return Number(e.searchParams.get("comic"))}catch(e){throw e.__="error getting canonical ID",e}})(),v=(()=>{const e=u("og:image");if(!e)throw new Error("error getting canonical image");return e.content.replace(/^http.+(comics.+)$/,"$1")})(),f=(()=>{const e=h(["body","center tbody","tr:nth-child(1)","td:nth-child(2) img:last-child"].join(" > "));if(e)return e;throw new Error("comic not found")})();var w=Object.freeze({__proto__:null,id:g,src:v,element:f});const b="(not found)",y="butiwouldratherbereading",I="unpixelate";var D=Object.freeze({__proto__:null,get:()=>Promise.resolve(h(".topnav a[href^=mailto]").getAttribute("href")).then((e=>{var t;return null!==(t=new URL(e).searchParams.get("subject"))&&void 0!==t?t:b})).then((e=>({head:"Contact",val:e})))});const _=e=>{const t=(e=>{const t=e.substr(1);return h(`a[name=${t}]`)})(e);return t.getBoundingClientRect().top},x=e=>{e.preventDefault();const t=window.scrollY-6+_(e.currentTarget.hash);window.scroll({top:t,behavior:"smooth"})};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
function O(e,t,r,n){return new(r||(r=Promise))((function(o,a){function s(e){try{i(n.next(e))}catch(e){a(e)}}function c(e){try{i(n.throw(e))}catch(e){a(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,c)}i((n=n.apply(e,t||[])).next())}))}const k=()=>{const{href:e}=window.location;return new URL(e)},L=(e,t)=>{var r;const n=t?new URL(t):k(),o=".php",a=new URL(n.origin);a.pathname=n.pathname.endsWith(o)?n.pathname:"index.php";for(const t of["comic",y]){const o=null!==(r=e[t])&&void 0!==r?r:n.searchParams.get(t);o&&a.searchParams.set(t,o)}return a},P=(e,t,r)=>{const n=Number(e.style.transform.replace(/\D/g,""));window.setTimeout((()=>{e.src=t}),400),e.style.transform=`rotateY(${(n+360)%720}deg)`,e.style.backgroundPosition=r},j=(e,t)=>{const r={[y]:t.selectedOptions[0].value},{src:n,position:o}=t.selectedOptions[0].dataset;for(const e of["left","right"])try{const t=h(`td[align=${e}] .nohover a`);t.href=L(r,t.href)}catch(t){const r="left"===e?" not":"";console.info(`Error updating ${e} arrow link.\nThis is (probably${r}) fine!`)}window.history.pushState(r[y],document.title,L(r)),P(e,n,o)},A=(e,t)=>{const r=Math.max(0,p(e).indexOf(t.toString()));return e.selectedIndex=r,e.selectedOptions[0]};const C=(e,t)=>{const r=(n=p(t),o=k().searchParams.get(y),n.includes(o)?o:"");var n,o;const a=L({comic:e.id,[y]:r});var s;A(t,r),function(e,t,r){O(this,void 0,void 0,(function*(){for(const t of e){const e=i("link",{rel:"prefetch",href:t});document.head.appendChild(e)}t.style.backgroundImage=`url(${r})`,t.style.transition=["transform 800ms","background-position 0ms ease 400ms"].join(", ")}))}((e=>Array.from(e.options).slice(1).map((e=>e.dataset.src)))(t),e.element,e.src),window.history.replaceState(r,document.title,a),d(t).on("change",(s=e.element,e=>{const t=e.currentTarget;j(s,t)})),d(window).on("popstate",((e,t)=>r=>{const{src:n,position:o}=A(e,r.state.toString()).dataset;P(t,n,o)})(t,e.element)),d(e.element).on("dblclick",((e,t)=>r=>{const n=e.options.length;let o=e.selectedIndex;for(;o===e.selectedIndex;)o=Math.floor(Math.random()*n);e.selectedIndex=o,j(t,e)})(t,e.element))},R="rendering",S=e=>t=>{var r;(r=t.currentTarget.checked,new Promise((e=>{chrome.storage.local.set({[R]:r},(()=>{e(r)}))}))).then((t=>{t?e.classList.remove(I):e.classList.add(I)}))},T=()=>{};var E=Object.freeze({__proto__:null,title:T,contact:T,rss:e=>{const t="yu-dereader";(e=>{const t=h("#blogpostheader"),r=i("a",{name:e});t.appendChild(r)})(t),(()=>{const e=h("div#container"),t=e.nextElementSibling.getBoundingClientRect().height,r=h("html").getBoundingClientRect().height,n=Math.max(e.getBoundingClientRect().height,r-t);e.style.minHeight=`${n}px`})(),e.setAttribute("href","#yu-dereader"),d(e).on("click",x)},view:([e,t],r)=>{C(r,e),((e,t)=>{d(e).on("change",S(t)),e.checked||t.classList.add(I)})(t,r.element)}});const M=({head:e,val:t})=>{const r=i("tr",{class:"egg"},i("td",{colspan:3},i("div",[i("h2",e),(n=t,"string"!=typeof n?n:i("span",n))])));var n;h("center table tbody").appendChild(r)},$=(e,t,r)=>{const n=e.get(t).map((e=>((e,t)=>{var r,n;const o=i("option",e.title);var a;return o.value=null!==(r=e.param)&&void 0!==r?r:"",o.dataset.position=null!==(n=e.position)&&void 0!==n?n:"0 0",o.dataset.src=`/${e.src?(a=e.src,a.includes(".")?a:`${a}.png`):t}`,o})(e,r))),o=m("optgroup",n);return o.label=t,o},B=(e,t)=>{const r=Array.from(e.keys()).map((r=>$(e,r,t)));return m("select",r)};var W=Object.freeze({__proto__:null,title:M,contact:M,rss:e=>{const{head:t,val:r}=e,n=i("a",{innerHTML:r,class:"rss"});return M({head:t,val:n}),n},view:({head:e,val:t},r)=>{const[n,o]=t;return Promise.all([B(n,r.src),(a=o,i("input",{type:"checkbox",checked:a})),i("span","Overlay"),i("span","Pixelated",{class:"pixel"})]).then((t=>{const[r,n,o,a]=t;return((e,t,r)=>{const n=i("div");for(let e=0;e<t.length;e++){const o=i("label",r[e],t[e]);n.appendChild(o)}M({head:e,val:n})})(e,[o,a],[r,n]),[r,n]}));var a}});var z=Object.freeze({__proto__:null,get:()=>Promise.resolve(l("//body//comment()[contains(., 'rss-title')]").data.toString().trim()).then((e=>({head:"RSS",val:e}))).catch((()=>({head:"RSS",val:b})))});var H=Object.freeze({__proto__:null,get:e=>{var t;return Promise.resolve(null!==(t=e.element.title)&&void 0!==t?t:b).then((e=>({head:"Title",val:e})))}}),N={categories:["T-Rex and Pals","Other Friends"],defaults:{title:"",src:"",param:"",position:"0 0",category:"",catID:0},overlays:[{title:"The Canonical Cartoon",src:"",param:""},{title:"One Where T-Rex Got Assimilated",src:"assimilated"},{title:"One Where T-Rex Wears More",src:"clothes"},{title:"One Where T-Rex Swears More",src:"frig"},{title:"Something More Historically Accurate",src:"feathers"},{title:"The Last Dinosaur Comic Ever",src:"lastever"},{title:"Before the Special Effects Are Added"},{title:"One Done in Watercolours",src:"watercolours"},{title:"D.C. Comics",src:"batman"},{title:"Just About T-Rex",src:"moretrex"},{title:"About Pirates",src:"pirates"},{title:"Dr. McNinja",src:"mcninja"},{title:"Penny Arcade",src:"penny",position:"7px 8px",catID:1},{title:"Problem Sleuth",catID:1},{title:"XKCD",catID:1},{title:"Sweet Bro and Hella Jeff",src:"sbahj",catID:1},{title:"A Lesson Is Learned But the Damage Is Irreversible",src:"alil",catID:1},{title:"BRODYQUEST",src:"brodyquest.gif",catID:1},{title:"Buttercup Festival",catID:1},{title:"Daisy Owl",catID:1},{title:"Nedroid",catID:1},{title:"Pokey the Penguin",src:"pokey",param:"pokey",catID:1},{title:"Shortpacked!",catID:1},{title:"Wigu Adventures",src:"wigu",param:"wigu",catID:1},{title:"Wondermark",catID:1},{title:"Achewood",position:"0 30px",catID:1},{title:"Registered Weapon",catID:1},{title:"Sister Claire",catID:1},{title:"The RIAA Version of the Internet",src:"censored.gif",param:"theRIAAversionoftheinternet",catID:1}]};const U=(e,t)=>""===t.src?1:""===e.src||e.title<t.title?-1:1,Y=e=>Array.from(e.keys()).reduce(((t,r)=>(t.set(r,e.get(r).sort(U)),t)),new Map),q=e=>{const t=new Map(e.categories.map((e=>[e,[]])));return e.overlays.forEach((r=>{const[n,o]=((e,t,r)=>{var n,o,a,s,c;const i=((e,t)=>{const{param:r=!1,title:n=t}=e;return""===r?r:n.toLowerCase().replace(/[^a-z]+/g,"")})(e,r.title);return[{title:null!==(n=e.title)&&void 0!==n?n:r.title,src:null!==(o=e.src)&&void 0!==o?o:i,param:null!==(a=e.param)&&void 0!==a?a:i,position:null!==(s=e.position)&&void 0!==s?s:r.position},t[null!==(c=e.catID)&&void 0!==c?c:r.catID]]})(r,e.categories,e.defaults);t.get(o).push(n)})),t};var F=Object.freeze({__proto__:null,get:function(e){const t={head:"View",val:[new Map,!1]};return Promise.all([Promise.resolve(N).then(q).then(Y),new Promise((e=>{chrome.storage.local.get([R],(t=>{var r;e(!(null!==(r=t[R])&&void 0!==r&&!r))}))}))]).then((e=>Object.assign({},t,{val:e}))).catch((()=>Promise.resolve(t)))}});(()=>{const e={title:H,contact:D,rss:z,view:F};for(const t of Object.keys(e)){const r={seed:e[t].get,lay:W[t],hatch:E[t]};r.seed(w).then((e=>r.lay(e,w))).then((e=>r.hatch(e,w)))}})()}();
